# # name: deops_pipeline_practice
# # on:
# #   workflow_dispatch:  # Fixed typo: workflow_dipatch -> workflow_dispatch
# #     inputs:
# #       branch_name:
# #         required: true
# #         description: "provide the branch_name"
# #         type: choice
# #         options:
# #           - main
# #       tag:
# #         description: "provide the tag"
# #         required: true
# #         type: string  # Fixed: environment -> string (environment is not a valid input type)
        
# # jobs:
# #   dev_job:
# #     name: dev job running
# #     runs-on: ubuntu-latest  # Fixed: run_on -> runs-on
# #     steps:  # Fixed: step -> steps
# #     - name: checkout code
# #       uses: actions/checkout@v4
# #       with:  # Added to specify branch based on input
# #         ref: ${{ inputs.branch_name }}
        
# #     - name: build docker image  # Better step name
# #       run: |
# #         echo "code build"
# #         docker build -t venky:${{ inputs.tag }} .  # Using input tag
# #         docker images
# # jobs:
# #   dev_job:
# #     name: dev job running
# #     runs-on: ubuntu-latest  # Fixed: run_on -> runs-on
# #     steps:  # Fixed: step -> steps
# #     - name: checkout code
# #       uses: actions/checkout@v4
# #       with:  # Added to specify branch based on input
# #         ref: ${{ inputs.branch_name }}
        
# #     - name: build docker image  # Better step name
# #       run: |
# #         echo "code build"
# #         docker build -t venky:${{ inputs.tag }} .  # Using input tag
# #         docker images

name: deops_pipeline_practice
on:
  workflow_dispatch:
    inputs:
      branch_name:
        required: true
        description: "provide the branch_name"
        type: choice
        options:
          - main
          - venky
      tag:
        description: "provide the tag"
        required: true
        type: string
        
# jobs:
#   # Stage 1: Build and Test
#   build-stage:
#     name: Build Docker Image
#     runs-on: ubuntu-latest
#     outputs:
#       image-tag: ${{ steps.tag.outputs.image-tag }}
    
#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4
#       with:
#         ref: ${{ inputs.branch_name }}
        
#     - name: Set up Docker Buildx
#       uses: docker/setup-buildx-action@v3
      
#     - name: Build Docker image
#       run: |
#         echo "Building Docker image from branch: ${{ inputs.branch_name }}"
#         docker build -t venky:${{ inputs.tag }} .
#         docker images
        
#     - name: Generate image tag
#       id: tag
#       run: |
#         echo "image-tag=venky:${{ inputs.tag }}" >> $GITHUB_OUTPUT
        
#     - name: Test Docker image
#       run: |
#         echo "Testing the built image"
#         docker run --rm venky:${{ inputs.tag }} echo "Image test successful!"

#   # EXTRA JOB 1: Code Quality Check
#   code-quality:
#     name: Code Quality Check
#     runs-on: ubuntu-latest
#     needs: build-stage  # Depends on build-stage
    
#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4
#       with:
#         ref: ${{ inputs.branch_name }}
        
#     - name: Run code linting
#       run: |
#         echo "Running code quality checks"
#         # Add your linting commands here
#         echo "âœ“ Code linting completed"
        
#     - name: Run static analysis
#       run: |
#         echo "Running static code analysis"
#         # Add static analysis tools here
#         echo "âœ“ Static analysis completed"

#   # EXTRA JOB 2: Dependency Scan
#   dependency-scan:
#     name: Dependency Security Scan
#     runs-on: ubuntu-latest
#     needs: build-stage  # Depends on build-stage
    
#     steps:
#     - name: Checkout code
#       uses: actions/checkout@v4
      
#     - name: Scan dependencies for vulnerabilities
#       run: |
#         echo "Scanning dependencies for security issues"
#         # Add dependency scanning tools here
#         echo "âœ“ Dependency scan completed"
        
#     - name: Check license compliance
#       run: |
#         echo "Checking license compliance"
#         # Add license check commands
#         echo "âœ“ License check completed"

#   # Stage 2: Security Scan (depends on all build-related jobs)
#   security-scan:
#     name: Container Security Scan
#     runs-on: ubuntu-latest
#     #needs: [build-stage, code-quality, dependency-scan]  # Depends on all build jobs
#     needs: build-stage 
#     steps:
#     - name: Run security scan
#       run: |
#         echo "Running security scan for image: ${{ needs.build-stage.outputs.image-tag }}"
#         # Add container security scanning tools here
#         echo "âœ“ Security scan completed"

#   # Stage 3: Deploy to Environment
#   deploy-stage:
#     name: Deploy Application
#     runs-on: ubuntu-latest
#     needs: [build-stage, code-quality, dependency-scan, security-scan]
    
#     steps:
#     - name: Deploy application
#       run: |
#         echo "Deploying image: ${{ needs.build-stage.outputs.image-tag }}"
#         echo "âœ“ Deployment to environment completed"
        
#     - name: Cleanup
#       if: always()
#       run: |
#         echo "Cleaning up resources"
#         docker system prune -f

jobs:
  setup-stage:
    name: ğŸ—ï¸ Setup Stage
    runs-on: ubuntu-latest
    steps:
      - name: Start Setup Stage
        uses: actions/github-script@v7
        with:
          script: |
            // Mark stage start visually
      - name: Checkout code
        uses: actions/checkout@v4

  build-stage:
    name: ğŸ“¦ Build Stage  
    runs-on: ubuntu-latest
    needs: setup-stage
    steps:
      - name: Mark Build Stage
        run: echo "## Build Stage Started"
      - name: Build application
        run: docker build -t myapp .

  # Using a proper stages action
  stage-management:
    name: ğŸ¯ Stage Management
    runs-on: ubuntu-latest
    steps:
      - name: Start CI Stage
        uses: nick-fields/refresh-stages@v2
        with:
          stage: CI
          action: start